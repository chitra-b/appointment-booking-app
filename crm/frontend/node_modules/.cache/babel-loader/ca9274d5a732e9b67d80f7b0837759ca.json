{"ast":null,"code":"import api from \"../../apiurl\";\nimport { tokenConfig } from \"../accounts/usermanagement/auth\";\nimport { APPOINTMENTS_FETCH_ERROR, APPOINTMENTS_LOADED, APPOINTMENTS_LOADING, DATE_FORMAT, YEAR_MONTH_FORMAT } from \"../types\";\nimport moment from \"moment\";\nimport axios from 'axios';\nvar CancelToken = axios.CancelToken;\nlet cancel;\nlet apiUrl;\nexport const getUserAppointments = (start_time = '', end_time = '', team_appointments = false, userDetails = {}) => (dispatch, getState) => {\n  dispatch({\n    type: APPOINTMENTS_LOADING\n  });\n  cancel && cancel();\n\n  if (userDetails) {\n    userDetailsMap = {\n      username: userDetails.user.username,\n      role: userDetails.user.groups.name\n    };\n  }\n\n  if (userDetailsMap && userDetailsMap.role === 'Admin' && team_appointments === true) {\n    apiUrl = \"/appointments/\" + \"?start_time_after=\" + start_time + \"&end_time_before=\" + end_time;\n  } else {\n    apiUrl = \"/appointments/\" + userDetailsMap.username + \"/\" + \"?start_time_after=\" + start_time + \"&end_time_before=\" + end_time;\n  }\n\n  api.get(apiUrl, tokenConfig(getState), {\n    cancelToken: new CancelToken(function executor(c) {\n      // An executor function receives a cancel function as a parameter\n      cancel = c;\n    })\n  }).then(res => {\n    dispatch({\n      type: APPOINTMENTS_LOADED,\n      payload: res.data.results\n    });\n  }).catch(err => {\n    let err_msg = \"\";\n\n    if (axios.isCancel(err)) {\n      console.log(\"Previous Request Cancelled\");\n    }\n\n    if (\"detail\" in err.response.data) {\n      err_msg = err.response.data.detail;\n    } else {\n      for (var key in err.response.data) {\n        err_msg += err.response.data[key];\n      }\n    }\n\n    dispatch({\n      type: APPOINTMENTS_FETCH_ERROR,\n      payload: err_msg\n    });\n  });\n};","map":{"version":3,"sources":["/Users/chitrabalasubramani/dev/crm/crm/frontend/src/actions/appointment/getuserappointments.js"],"names":["api","tokenConfig","APPOINTMENTS_FETCH_ERROR","APPOINTMENTS_LOADED","APPOINTMENTS_LOADING","DATE_FORMAT","YEAR_MONTH_FORMAT","moment","axios","CancelToken","cancel","apiUrl","getUserAppointments","start_time","end_time","team_appointments","userDetails","dispatch","getState","type","userDetailsMap","username","user","role","groups","name","get","cancelToken","executor","c","then","res","payload","data","results","catch","err","err_msg","isCancel","console","log","response","detail","key"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,cAAhB;AACA,SAASC,WAAT,QAA4B,iCAA5B;AACA,SACEC,wBADF,EAEEC,mBAFF,EAGEC,oBAHF,EAIEC,WAJF,EAKEC,iBALF,QAMO,UANP;AAOA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,IAAIC,WAAW,GAAGD,KAAK,CAACC,WAAxB;AACA,IAAIC,MAAJ;AACA,IAAIC,MAAJ;AAGA,OAAO,MAAMC,mBAAmB,GAAI,CAACC,UAAU,GAAC,EAAZ,EAAgBC,QAAQ,GAAC,EAAzB,EAA6BC,iBAAiB,GAAC,KAA/C,EAAsDC,WAAW,GAAC,EAAlE,KAAyE,CAC3GC,QAD2G,EAE3GC,QAF2G,KAGxG;AACHD,EAAAA,QAAQ,CAAC;AAAEE,IAAAA,IAAI,EAAEf;AAAR,GAAD,CAAR;AACAM,EAAAA,MAAM,IAAIA,MAAM,EAAhB;;AACA,MAAIM,WAAJ,EAAiB;AACfI,IAAAA,cAAc,GAAG;AAACC,MAAAA,QAAQ,EAAEL,WAAW,CAACM,IAAZ,CAAiBD,QAA5B;AACbE,MAAAA,IAAI,EAAEP,WAAW,CAACM,IAAZ,CAAiBE,MAAjB,CAAwBC;AADjB,KAAjB;AAED;;AAED,MAAIL,cAAc,IAAIA,cAAc,CAACG,IAAf,KAAwB,OAA1C,IAAqDR,iBAAiB,KAAK,IAA/E,EACA;AACEJ,IAAAA,MAAM,GAAG,mBACT,oBADS,GACYE,UADZ,GACuB,mBADvB,GAC2CC,QADpD;AAED,GAJD,MAKK;AACHH,IAAAA,MAAM,GAAG,mBAAkBS,cAAc,CAACC,QAAjC,GAA4C,GAA5C,GACT,oBADS,GACYR,UADZ,GACuB,mBADvB,GAC2CC,QADpD;AAED;;AACAd,EAAAA,GAAG,CACD0B,GADF,CACMf,MADN,EAEGV,WAAW,CAACiB,QAAD,CAFd,EAGG;AAAES,IAAAA,WAAW,EAAE,IAAIlB,WAAJ,CAAgB,SAASmB,QAAT,CAAkBC,CAAlB,EAAqB;AAClD;AACAnB,MAAAA,MAAM,GAAGmB,CAAT;AACD,KAHc;AAAf,GAHH,EASEC,IATF,CASOC,GAAG,IAAI;AACXd,IAAAA,QAAQ,CAAC;AACPE,MAAAA,IAAI,EAAEhB,mBADC;AAEP6B,MAAAA,OAAO,EAAED,GAAG,CAACE,IAAJ,CAASC;AAFX,KAAD,CAAR;AAID,GAdF,EAeEC,KAfF,CAeQC,GAAG,IAAI;AACZ,QAAIC,OAAO,GAAG,EAAd;;AACA,QAAI7B,KAAK,CAAC8B,QAAN,CAAeF,GAAf,CAAJ,EAAwB;AACtBG,MAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACD;;AACD,QAAI,YAAYJ,GAAG,CAACK,QAAJ,CAAaR,IAA7B,EAAmC;AACjCI,MAAAA,OAAO,GAAGD,GAAG,CAACK,QAAJ,CAAaR,IAAb,CAAkBS,MAA5B;AACD,KAFD,MAEO;AACL,WAAK,IAAIC,GAAT,IAAgBP,GAAG,CAACK,QAAJ,CAAaR,IAA7B,EAAmC;AACjCI,QAAAA,OAAO,IAAID,GAAG,CAACK,QAAJ,CAAaR,IAAb,CAAkBU,GAAlB,CAAX;AACD;AACF;;AACD1B,IAAAA,QAAQ,CAAC;AACPE,MAAAA,IAAI,EAAEjB,wBADC;AAEP8B,MAAAA,OAAO,EAAEK;AAFF,KAAD,CAAR;AAID,GA/BF;AAgCF,CApDM","sourcesContent":["import api from \"../../apiurl\";\nimport { tokenConfig } from \"../accounts/usermanagement/auth\";\nimport {\n  APPOINTMENTS_FETCH_ERROR,\n  APPOINTMENTS_LOADED,\n  APPOINTMENTS_LOADING,\n  DATE_FORMAT,\n  YEAR_MONTH_FORMAT\n} from \"../types\";\nimport moment from \"moment\";\nimport axios from 'axios';\nvar CancelToken = axios.CancelToken;\nlet cancel;\nlet apiUrl;\n\n\nexport const getUserAppointments =  (start_time='', end_time='', team_appointments=false, userDetails={}) => (\n  dispatch,\n  getState\n) => {\n  dispatch({ type: APPOINTMENTS_LOADING });\n  cancel && cancel();\n  if (userDetails) {\n    userDetailsMap = {username: userDetails.user.username,\n        role: userDetails.user.groups.name};\n  }\n    \n  if (userDetailsMap && userDetailsMap.role === 'Admin' && team_appointments === true)\n  {\n    apiUrl = \"/appointments/\"+\n    \"?start_time_after=\"+start_time+\"&end_time_before=\"+end_time;\n  }\n  else {\n    apiUrl = \"/appointments/\"+ userDetailsMap.username + \"/\" +\n    \"?start_time_after=\"+start_time+\"&end_time_before=\"+end_time;\n  }\n   api\n    .get(apiUrl,\n      tokenConfig(getState),\n      { cancelToken: new CancelToken(function executor(c) {\n        // An executor function receives a cancel function as a parameter\n        cancel = c;\n      })\n    }\n    )\n    .then(res => {\n      dispatch({\n        type: APPOINTMENTS_LOADED,\n        payload: res.data.results\n      });\n    })\n    .catch(err => {\n      let err_msg = \"\";\n      if (axios.isCancel(err)){\n        console.log(\"Previous Request Cancelled\")\n      }\n      if (\"detail\" in err.response.data) {\n        err_msg = err.response.data.detail;\n      } else {\n        for (var key in err.response.data) {\n          err_msg += err.response.data[key];\n        }\n      }\n      dispatch({\n        type: APPOINTMENTS_FETCH_ERROR,\n        payload: err_msg\n      });\n    });\n};"]},"metadata":{},"sourceType":"module"}